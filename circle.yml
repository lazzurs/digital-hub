machine:
  node:
    version: 6.11.0
  php:
  services:
    - docker

dependencies:
  override:
    - cd moj-be && make build && make push
    - cd moj-fe && make build && make push

test:
    pre:
        - cd moj-fe && make test
        - cd moj-be && make test

deployment:
    development:
        branch: master
        commands:
            - ssh -p 50000 -l docker -fNL localhost:2374:/var/run/docker.sock ssh.dev.hub.service.hmpps.dsd.io
            - DOCKER_HOST=localhost:2374 docker stack up -c docker-compose-prod.yml hub-dev
