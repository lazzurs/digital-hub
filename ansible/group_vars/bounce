ssh_use_pam: true
ssh_google_auth: true
ssh_challengeresponseauthentication: true
ssh_allow_tcp_forwarding: true
unattended_automatic_reboot: true
unattended_automatic_reboot_time: 02:00
unattended_ignore_apps_require_restart: true
unattended_mail: noms-studio-webops@digital.justice.gov.uk
unattended_origins_patterns:
  - 'origin=Ubuntu,archive=${distro_codename}-security'
  - 'o=Ubuntu,a=${distro_codename}'
  - 'o=Ubuntu,a=${distro_codename}-updates'

nginx_upstreams:
  - name: berwyn_hub
    servers: {
      "berwyn.mycloudgateway.co.uk:10001"
    }
  - name: wayland_hub
    servers: {
      "wayland.mycloudgateway.co.uk:10001"
    }

nginx_vhosts:
#  - listen: "443 ssl http2"
  - listen: "80"
    server_name: "bli.prod.admin.hub.service.hmpps.dsd.io"
    state: "present"
    extra_parameters: |
      ignore_invalid_headers off;
      location / {
        proxy_pass http://berwyn_hub;
        proxy_set_header   Host              $host;
        proxy_set_header   X-Real-IP         $remote_addr;
        proxy_set_header   X-Forwarded-For   $proxy_add_x_forwarded_for;
        proxy_set_header   X-Forwarded-Proto $scheme;
      }
  - listen: "80"
    server_name: "wli.prod.admin.hub.service.hmpps.dsd.io"
    state: "present"
    extra_parameters: |
      ignore_invalid_headers off;
      location / {
        proxy_pass http://wayland_hub;
        proxy_set_header   Host              $host;
        proxy_set_header   X-Real-IP         $remote_addr;
        proxy_set_header   X-Forwarded-For   $proxy_add_x_forwarded_for;
        proxy_set_header   X-Forwarded-Proto $scheme;
      }
  
firewall_state: started
firewall_enabled_at_boot: true
firewall_allowed_tcp_ports:
  - "22"
  - "80"
  - "443"
#firewall_additional_rules:
#  - "iptables -A INPUT -p tcp --dport 80 -s 35.177.252.195 -j ACCEPT"
#  - "iptables -A INPUT -p tcp --dport 443 -s 35.177.252.195 -j ACCEPT"
